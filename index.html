<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>m2f-crm</title>
    <!-- Apply theme and preload logo immediately to prevent flash -->
    <script>
      (function() {
        try {
          const storedTheme = localStorage.getItem('workspace-theme');
          if (storedTheme) {
            const theme = JSON.parse(storedTheme);
            const root = document.documentElement;

            // Helper function to convert hex to HSL
            function hexToHsl(hex) {
              if (!hex || typeof hex !== 'string') return '0 0% 0%';
              const cleanHex = hex.replace('#', '');
              const result = /^([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(cleanHex);
              if (!result) return '0 0% 0%';

              const r = parseInt(result[1], 16) / 255;
              const g = parseInt(result[2], 16) / 255;
              const b = parseInt(result[3], 16) / 255;
              
              const max = Math.max(r, g, b);
              const min = Math.min(r, g, b);
              const diff = max - min;
              
              let h = 0;
              let s = 0;
              const l = (max + min) / 2;
              
              if (diff !== 0) {
                s = l > 0.5 ? diff / (2 - max - min) : diff / (max + min);
                
                switch (max) {
                  case r: h = ((g - b) / diff + (g < b ? 6 : 0)) / 6; break;
                  case g: h = ((b - r) / diff + 2) / 6; break;
                  case b: h = ((r - g) / diff + 4) / 6; break;
                }
              }
              
              const hDeg = Math.round(h * 360);
              const sPercent = Math.round(s * 100);
              const lPercent = Math.round(l * 100);
              
              return hDeg + ' ' + sPercent + '% ' + lPercent + '%';
            }

            // Apply colors
            if (theme.primary_color) {
              const primaryHsl = hexToHsl(theme.primary_color);
              root.style.setProperty('--primary', primaryHsl);
              root.style.setProperty('--ring', primaryHsl);
            }
            if (theme.secondary_color) {
              root.style.setProperty('--secondary', hexToHsl(theme.secondary_color));
            }
            if (theme.accent_color) {
              root.style.setProperty('--accent', hexToHsl(theme.accent_color));
            }

            // Apply theme mode
            if (theme.theme_mode) {
              root.classList.remove('light', 'dark');
              root.classList.add(theme.theme_mode);
            }
          }

          // Store logo URL in a global variable for React to use immediately
          const storedLogo = localStorage.getItem('workspace-logo');
          if (storedLogo) {
            window.__WORKSPACE_LOGO__ = storedLogo;
            // Preload image
            const img = new Image();
            img.src = storedLogo;
          } else {
            window.__WORKSPACE_LOGO__ = null;
          }
        } catch (e) {
          // Silently fail - React will apply theme later
        }
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
